---
import fs from 'fs'
import path from 'path'
import matter from 'gray-matter'
import Layout from '../layouts/BaseLayout.astro'

const postsDir = './src/content'
const files = fs.readdirSync(postsDir)
const posts = files
  .filter(file => file.endsWith('.md'))
  .map(file => {
    const slug = file.replace('.md', '')
    const content = fs.readFileSync(path.join(postsDir, file), 'utf-8')
    const { data } = matter(content)
    return {
      slug,
      title: data.title,
      date: data.date,
      summary: data.summary || ''
    }
  })
  .sort((a, b) => new Date(b.date) - new Date(a.date))
---

<Layout>
  <h2 class="text-xl font-semibold mb-6">Latest Articles</h2>

  <ul class="space-y-5">
    {posts.map(post => (
      <li class="border-b border-zinc-800 pb-4">
        <a href={`/articles/${post.slug}`} class="text-xl text-white hover:underline">
          {post.title}
        </a>
        <p class="text-sm text-zinc-400 mt-1">{post.date}</p>
        {post.summary && <p class="text-zinc-300 mt-2 text-sm">{post.summary}</p>}
      </li>
    ))}
  </ul>
</Layout>
