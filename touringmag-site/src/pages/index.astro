---
import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import FormattedDate from "../components/FormattedDate.astro";

const blogPosts = (await getCollection("blog")).sort(
  (a, b) => new Date(b.data.pubDate) - new Date(a.data.pubDate)
);
const gearPosts = (await getCollection("gear")).sort(
  (a, b) => new Date(b.data.pubDate) - new Date(a.data.pubDate)
);
const upgradePosts = (await getCollection("upgrades")).sort(
  (a, b) => new Date(b.data.pubDate) - new Date(a.data.pubDate)
);
const guidePosts = (await getCollection("guides")).sort(
  (a, b) => new Date(b.data.pubDate) - new Date(a.data.pubDate)
);

const placeholder = "/assets/blog-placeholder-1.jpg";
const coverStory = blogPosts[0];
---

<BaseLayout title="TouringMag | Motorcycle Touring Magazine" description="Motorcycle touring magazine with gear reviews, upgrades, riding guides, and rider stories.">

  <!-- üîù Cover Story -->
  {coverStory && (
    <section style="position:relative; margin-bottom:3rem;">
      <img src={coverStory.data.heroImage || placeholder} alt={coverStory.data.title}
           style="width:100%; height:420px; object-fit:cover; border-radius:12px;" />
      <div style="position:absolute; inset:0; background:rgba(0,0,0,0.55); border-radius:12px; display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; padding:1rem;">
        <h1 style="font-size:2.5rem; font-weight:800; color:white; margin-bottom:0.5rem; max-width:900px;">
          {coverStory.data.title}
        </h1>
        <p style="color:#ddd; max-width:700px; margin-bottom:0.5rem;">{coverStory.data.summary}</p>
        <p style="color:#bbb; font-size:0.9rem; margin-bottom:1rem;">
          <FormattedDate date={coverStory.data.pubDate} />
        </p>
        <a href={`/blog/${coverStory.slug}`} 
           style="background:#ea580c; color:white; padding:0.75rem 1.5rem; border-radius:8px; text-decoration:none; font-weight:600;">
          Read More
        </a>
      </div>
    </section>
  )}

  <!-- üîª Section Builder -->
  <section style="max-width:1200px; margin:0 auto; padding:2rem 1rem; display:grid; gap:3rem;">

    <!-- Blog -->
    <div>
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
        <h2 style="font-size:1.75rem; font-weight:700; color:#f97316;">Latest Blog Articles</h2>
        <a href="/blog" class="bg-orange-600 text-white px-3 py-1 rounded hover:bg-orange-700">View All ‚Üí</a>
      </div>
      <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(280px,1fr)); gap:2rem;">
        {blogPosts.slice(1,4).map((post) => (
          <a href={`/blog/${post.slug}`} class="bg-neutral-900 rounded-lg overflow-hidden no-underline text-inherit flex flex-col">
            <img src={post.data.heroImage || placeholder} alt={post.data.title} class="w-full h-40 object-cover" />
            <div class="p-4 flex-1 flex flex-col">
              <h3 class="text-lg font-semibold text-white mb-2">{post.data.title}</h3>
              <p class="text-sm text-gray-400 flex-1">{post.data.summary}</p>
              <p class="text-xs text-gray-500 mt-2"><FormattedDate date={post.data.pubDate} /></p>
            </div>
          </a>
        ))}
      </div>
    </div>

    <!-- Gear -->
    <div>
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold text-orange-500">Latest Gear Reviews</h2>
        <a href="/gear" class="bg-orange-600 text-white px-3 py-1 rounded hover:bg-orange-700">View All ‚Üí</a>
      </div>
      <div class="grid md:grid-cols-3 gap-6">
        {gearPosts.slice(0,3).map((post) => (
          <a href={`/gear/${post.slug}`} class="bg-neutral-900 rounded-lg overflow-hidden no-underline text-inherit flex flex-col">
            <img src={post.data.heroImage || placeholder} alt={post.data.title} class="w-full h-40 object-cover" />
            <div class="p-4 flex-1 flex flex-col">
              <h3 class="text-lg font-semibold text-white mb-2">{post.data.title}</h3>
              {post.data.rating && <p class="text-yellow-400 font-semibold">‚≠ê {post.data.rating}/5</p>}
            </div>
          </a>
        ))}
      </div>
    </div>

    <!-- Upgrades -->
    <div>
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold text-orange-500">Latest Upgrades</h2>
        <a href="/upgrades" class="bg-orange-600 text-white px-3 py-1 rounded hover:bg-orange-700">View All ‚Üí</a>
      </div>
      <div class="grid md:grid-cols-3 gap-6">
        {upgradePosts.slice(0,3).map((post) => (
          <a href={`/upgrades/${post.slug}`} class="bg-neutral-900 rounded-lg overflow-hidden no-underline text-inherit flex flex-col">
            <img src={post.data.heroImage || placeholder} alt={post.data.title} class="w-full h-40 object-cover" />
            <div class="p-4 flex-1 flex flex-col">
              <h3 class="text-lg font-semibold text-white mb-2">{post.data.title}</h3>
              <p class="text-sm text-gray-400 flex-1">{post.data.summary}</p>
            </div>
          </a>
        ))}
      </div>
    </div>

    <!-- Guides -->
    <div>
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold text-orange-500">Latest Guides</h2>
        <a href="/guides" class="bg-orange-600 text-white px-3 py-1 rounded hover:bg-orange-700">View All ‚Üí</a>
      </div>
      <div class="grid md:grid-cols-3 gap-6">
        {guidePosts.slice(0,3).map((post) => (
          <a href={`/guides/${post.slug}`} class="bg-neutral-900 rounded-lg overflow-hidden no-underline text-inherit flex flex-col">
            <img src={post.data.heroImage || placeholder} alt={post.data.title} class="w-full h-40 object-cover" />
            <div class="p-4 flex-1 flex flex-col">
              <h3 class="text-lg font-semibold text-white mb-2">{post.data.title}</h3>
              {post.data.difficulty && (
                <p class="text-blue-400 font-semibold">Difficulty: {post.data.difficulty}</p>
              )}
            </div>
          </a>
        ))}
      </div>
    </div>

  </section>
</BaseLayout>
