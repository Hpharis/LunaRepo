---
import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import FormattedDate from "../components/FormattedDate.astro";

const blogPosts = (await getCollection("blog")).sort(
  (a, b) => new Date(b.data.pubDate) - new Date(a.data.pubDate)
);
const gearPosts = (await getCollection("gear")).sort(
  (a, b) => new Date(b.data.pubDate) - new Date(a.data.pubDate)
);
const upgradePosts = (await getCollection("upgrades")).sort(
  (a, b) => new Date(b.data.pubDate) - new Date(a.data.pubDate)
);
const guidePosts = (await getCollection("guides")).sort(
  (a, b) => new Date(b.data.pubDate) - new Date(a.data.pubDate)
);

const placeholder = "/assets/blog-placeholder-1.jpg";
const coverStory = blogPosts[0];
---

<BaseLayout title="TouringMag | Motorcycle Touring Magazine" description="Motorcycle touring magazine with gear reviews, upgrades, riding guides, and rider stories.">

  <!-- üîù Cover Story -->
  {coverStory && (
    <section style="position:relative; margin-bottom:3rem;">
      <img src={coverStory.data.heroImage || placeholder} alt={coverStory.data.title}
           style="width:100%; height:420px; object-fit:cover; border-radius:12px;" />
      <div style="position:absolute; inset:0; background:rgba(0,0,0,0.55); border-radius:12px; display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; padding:1rem;">
        <h1 style="font-size:2.5rem; font-weight:800; color:white; margin-bottom:0.5rem; max-width:900px;">
          {coverStory.data.title}
        </h1>
        <p style="color:#ddd; max-width:700px; margin-bottom:0.5rem;">{coverStory.data.summary}</p>
        <p style="color:#bbb; font-size:0.9rem; margin-bottom:1rem;">
          <FormattedDate date={coverStory.data.pubDate} />
        </p>
        <a href={`/blog/${coverStory.slug}`} 
           style="background:#ea580c; color:white; padding:0.75rem 1.5rem; border-radius:8px; text-decoration:none; font-weight:600;">
          Read More
        </a>
      </div>
    </section>
  )}

  <!-- üîª Section Builder -->
  <section style="max-width:1200px; margin:0 auto; padding:2rem 1rem; display:grid; gap:3rem;">

    <!-- Blog -->
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
  <h2 style="font-size:1.75rem; font-weight:700; color:#f97316;">Latest Blog Articles</h2>
  <a href="/blog" 
     style="background:#ea580c; color:white; padding:0.4rem 0.9rem; border-radius:6px; font-size:0.85rem; font-weight:600; text-decoration:none; transition:background 0.2s;">
    View All ‚Üí
  </a>
</div>

      <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(280px,1fr)); gap:2rem;">
        {blogPosts.slice(1,4).map((post) => (
          <a href={`/blog/${post.slug}`} style="background:#111; border-radius:12px; overflow:hidden; text-decoration:none; color:inherit; display:flex; flex-direction:column;">
            <img src={post.data.heroImage || placeholder} alt={post.data.title} style="width:100%; height:160px; object-fit:cover;" />
            <div style="padding:1rem; flex:1; display:flex; flex-direction:column;">
              <h3 style="font-size:1.1rem; font-weight:600; color:white; margin-bottom:0.5rem;">{post.data.title}</h3>
              <p style="font-size:0.9rem; color:#bbb; flex:1;">{post.data.summary}</p>
              <p style="font-size:0.8rem; color:#888; margin-top:0.5rem;"><FormattedDate date={post.data.pubDate} /></p>
            </div>
          </a>
        ))}
      </div>
    </div>

    <!-- Gear -->
    <div>
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
  <h2 style="font-size:1.75rem; font-weight:700; color:#f97316;">Latest Blog Articles</h2>
  <a href="/blog" 
     style="background:#ea580c; color:white; padding:0.4rem 0.9rem; border-radius:6px; font-size:0.85rem; font-weight:600; text-decoration:none; transition:background 0.2s;">
    View All ‚Üí
  </a>
</div>

      <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(280px,1fr)); gap:2rem;">
        {gearPosts.slice(0,3).map((post) => (
          <a href={`/gear/${post.slug}`} style="background:#111; border-radius:12px; overflow:hidden; text-decoration:none; color:inherit; display:flex; flex-direction:column;">
            <img src={post.data.heroImage || placeholder} alt={post.data.title} style="width:100%; height:160px; object-fit:cover;" />
            <div style="padding:1rem; flex:1; display:flex; flex-direction:column;">
              <h3 style="font-size:1.1rem; font-weight:600; color:white; margin-bottom:0.5rem;">{post.data.title}</h3>
              {post.data.rating && <p style="color:#facc15; font-weight:600;">‚≠ê {post.data.rating}/5</p>}
            </div>
          </a>
        ))}
      </div>
    </div>

    <!-- Upgrades -->
    <div>
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
  <h2 style="font-size:1.75rem; font-weight:700; color:#f97316;">Latest Blog Articles</h2>
  <a href="/blog" 
     style="background:#ea580c; color:white; padding:0.4rem 0.9rem; border-radius:6px; font-size:0.85rem; font-weight:600; text-decoration:none; transition:background 0.2s;">
    View All ‚Üí
  </a>
</div>

      <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(280px,1fr)); gap:2rem;">
        {upgradePosts.slice(0,3).map((post) => (
          <a href={`/upgrades/${post.slug}`} style="background:#111; border-radius:12px; overflow:hidden; text-decoration:none; color:inherit; display:flex; flex-direction:column;">
            <img src={post.data.heroImage || placeholder} alt={post.data.title} style="width:100%; height:160px; object-fit:cover;" />
            <div style="padding:1rem; flex:1; display:flex; flex-direction:column;">
              <h3 style="font-size:1.1rem; font-weight:600; color:white; margin-bottom:0.5rem;">{post.data.title}</h3>
              <p style="font-size:0.9rem; color:#bbb; flex:1;">{post.data.summary}</p>
            </div>
          </a>
        ))}
      </div>
    </div>

    <!-- Guides -->
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
  <h2 style="font-size:1.75rem; font-weight:700; color:#f97316;">Latest Blog Articles</h2>
  <a href="/blog" 
     style="background:#ea580c; color:white; padding:0.4rem 0.9rem; border-radius:6px; font-size:0.85rem; font-weight:600; text-decoration:none; transition:background 0.2s;">
    View All ‚Üí
  </a>
</div>

      <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(280px,1fr)); gap:2rem;">
        {guidePosts.slice(0,3).map((post) => (
          <a href={`/guides/${post.slug}`} style="background:#111; border-radius:12px; overflow:hidden; text-decoration:none; color:inherit; display:flex; flex-direction:column;">
            <img src={post.data.heroImage || placeholder} alt={post.data.title} style="width:100%; height:160px; object-fit:cover;" />
            <div style="padding:1rem; flex:1; display:flex; flex-direction:column;">
              <h3 style="font-size:1.1rem; font-weight:600; color:white; margin-bottom:0.5rem;">{post.data.title}</h3>
              {post.data.difficulty && <p style="color:#60a5fa; font-weight:600;">Difficulty: {post.data.difficulty}</p>}
            </div>
          </a>
        ))}
      </div>
    </div>

  </section>
</BaseLayout>
